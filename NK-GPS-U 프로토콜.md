# **GPS NMEA 데이터 처리 프로토콜**

이 문서는 표준 NMEA-0183 프로토콜을 따르는 GPS 센서의 데이터를 수신하여 처리하는 프로그램 개발 가이드입니다. GPS의 초기 상태(콜드 스타트)부터 안정적인 데이터 수신까지의 과정을 3단계로 나누어 설명합니다.

### **\#\# 1단계: 콜드 스타트 (GPS 수신 대기)**

프로그램 시작 직후 또는 GPS가 위성 신호를 찾고 있는 초기 단계입니다. 이 단계에서는 아직 유효한 위치 데이터를 얻을 수 없습니다.

* **목표**: 유효한 GPS 신호(Fix)가 잡힐 때까지 대기하며 현재 상태를 파악합니다.  
* **핵심 NMEA 문장**: $GPRMC, $GPGGA  
* **상태 판단 기준**:  
  * $GPRMC 문장의 2번째 필드(상태) 값이 \*\*V (Void)\*\*일 경우  
  * $GPGGA 문장의 6번째 필드(수신 상태) 값이 \*\*0 (Invalid)\*\*일 경우  
* **프로그램 로직**:  
  1. 시리얼 포트 등으로부터 NMEA 문장을 한 줄씩 읽어옵니다.  
  2. 읽어온 문장이 $GPRMC 또는 $GPGGA인지 확인합니다.  
  3. 위의 '상태 판단 기준'에 해당하면, "GPS 신호 수신 중..."과 같은 상태 메시지를 표시하고 다음 문장을 읽어옵니다.  
  4. 이 단계에서는 위치, 속도 등 다른 필드를 파싱할 필요가 없습니다.

**코드 예시 (의사 코드)**:

line \= read\_gps\_data()  
if line.startsWith("$GPRMC"):  
    fields \= line.split(',')  
    if fields\[2\] \== "V":  
        update\_status("수신 대기 중...")  
elif line.startsWith("$GPGGA"):  
    fields \= line.split(',')  
    if fields\[6\] \== "0":  
        update\_status("수신 대기 중...")

### **\#\# 2단계: 수신 상태 확인 (Fix 감지)**

GPS가 충분한 수의 위성을 감지하고 위치 계산을 시작하면, 데이터의 상태 값이 바뀝니다. 프로그램은 이 변화를 감지하여 다음 단계로 전환해야 합니다.

* **목표**: 데이터가 '유효' 상태로 바뀌는 것을 감지하고 데이터 처리 단계로 넘어갑니다.  
* **핵심 NMEA 문장**: $GPRMC, $GPGGA  
* **상태 판단 기준**:  
  * $GPRMC 문장의 2번째 필드(상태) 값이 \*\*A (Active)\*\*로 변경될 경우  
  * $GPGGA 문장의 6번째 필드(수신 상태) 값이 **1 (GPS fix)** 또는 \*\*2 (DGPS fix)\*\*로 변경될 경우  
* **프로그램 로직**:  
  1. 1단계와 같이 NMEA 문장을 계속 읽어옵니다.  
  2. 위의 '상태 판단 기준' 중 하나라도 만족되면, GPS가 성공적으로 위치를 수신한 것으로 판단합니다.  
  3. "GPS 신호 수신 완료" 메시지를 표시하고, 프로그램의 상태를 '안정 상태'로 전환하여 3단계 로직을 수행하도록 합니다.

### **\#\# 3단계: 데이터 파싱 및 활용 (안정 상태)**

GPS가 안정적으로 위치 정보를 보내주는 주된 상태입니다. 이 단계에서 필요한 데이터를 추출하여 프로그램에서 활용합니다.

* **목표**: 유효한 NMEA 문장에서 위도, 경도, 고도, 속도 등의 데이터를 추출하고 변환하여 사용합니다.  
* **핵심 NMEA 문장**: **$GPGGA** (위도, 경도, 고도, 위성 수 등 핵심 정보 포함)  
* **주요 데이터 필드 ($GPGGA 기준)**:  
  * 필드 1: UTC 시간 (예: 063802.00)  
  * 필드 2: 위도 (예: 3724.41511)  
  * 필드 3: 남/북 구분 (N/S)  
  * 필드 4: 경도 (예: 12643.37321)  
  * 필드 5: 동/서 구분 (E/W)  
  * 필드 7: 사용된 위성 수 (예: 07\)  
  * 필드 9: 고도 (단위: 미터, 예: 42.8)  
* **프로그램 로직**:  
  1. $GPGGA 문장이 수신되면 콤마(,)를 기준으로 문자열을 분리하여 각 필드 값을 배열이나 구조체에 저장합니다.  
  2. **(중요) 좌표 형식 변환**: NMEA의 DDMM.MMMMM 형식 좌표를 일반적인 **십진수 도(Decimal Degree)** 형식으로 변환합니다.  
     * **변환 공식**: 도(DD) \+ (분(MM.MMMMM) / 60\)  
     * **예시 (위도)**: 3724.41511 \-\> 37 \+ (24.41511 / 60\) \= 37.4069185  
     * **예시 (경도)**: 12643.37321 \-\> 126 \+ (43.37321 / 60\) \= 126.7228868  
  3. 필드 3(N/S)과 필드 5(E/W) 값을 확인하여 최종 좌표의 부호를 결정합니다. (S 또는 W일 경우 음수(-)로 처리)  
  4. 변환된 좌표와 고도, 위성 수 등의 데이터를 프로그램 변수에 저장하거나 UI에 업데이트합니다.  
  5. (권장) 데이터 무결성을 위해 문장 끝의 체크섬(예: \*6C)을 계산하여 수신된 값과 일치하는지 검증하는 로직을 추가합니다.  
  6. 주기적으로 $GPRMC의 상태 필드를 확인하여 신호가 다시 끊어지는 경우(상태가 V로 바뀌는 경우)를 감지하고 1단계로 돌아가도록 처리합니다.