# SrVsDataset 프로젝트 구조

## 프로젝트 개요
차선 자동 재도색 AI 모델 개발을 위한 데이터셋 수집 시스템입니다.

## 아키텍처 구조

### 📂 Models (데이터 모델)
**위치**: `SrVsDataset/Models/`

#### `EnvironmentSettings.cs`
- 환경 설정 정보 정의
- 도로 종류, 날씨, 시간대, 녹화 위치 enum 타입

#### `CameraSettings.cs`
- 카메라 설정 정보
- 노출 시간, 화이트밸런스 모드/색온도

#### `RecordingMetadata.cs`
- JSON으로 저장될 메타데이터 구조
- 타임스탬프, 환경정보, 카메라설정, 하드웨어 정보

#### `RecordingSession.cs`
- 녹화 세션 관리
- 시작/종료 시간, 메타데이터, 파일명 생성

### 📂 Interfaces (인터페이스)
**위치**: `SrVsDataset/Interfaces/`

#### `ICameraService.cs`
- 카메라 제어 인터페이스
- 초기화, 프리뷰 시작/중지, 설정 변경

#### `IVideoRecordingService.cs`
- 비디오 녹화 인터페이스
- 녹화 시작/중지, 프레임 추가

#### `IFileManagementService.cs`
- 파일 관리 인터페이스
- 디렉토리 구조 생성, 메타데이터 저장

#### `IGpsService.cs`
- GPS 서비스 인터페이스
- 위치 정보 수집

### 📂 Services (서비스 구현)
**위치**: `SrVsDataset/Services/`

#### `MVCameraService.cs` ⭐
- **역할**: MVSDK를 사용한 실제 카메라 제어
- **주요 기능**:
  - 카메라 초기화 및 연결
  - 실시간 프레임 캡처 (30 FPS)
  - 노출 시간, 화이트밸런스 설정
  - 카메라 온도 모니터링
- **이벤트**: `FrameReceived`, `TemperatureChanged`

#### `VideoRecordingService.cs`
- 비디오 녹화 기능
- 프레임 데이터를 비디오 파일로 저장

#### `FileManagementService.cs`
- 파일 시스템 관리
- 데이터셋 폴더 구조 생성
- JSON 메타데이터 저장

#### `MockCameraService.cs`
- 테스트용 모의 카메라 서비스

### 📂 ViewModels (MVVM 패턴)
**위치**: `SrVsDataset/ViewModels/`

#### `MainViewModel.cs` ⭐
- **역할**: 메인 UI와 비즈니스 로직 연결
- **주요 속성**:
  - `IsCameraInitializing`: 카메라 초기화 중 상태
  - `IsCameraConnected`: 카메라 연결 상태
  - `IsRecording`: 녹화 진행 상태
  - `CameraPreview`: 실시간 카메라 이미지
- **주요 명령어**:
  - `InitializeCameraCommand`: 카메라 초기화
  - `StartRecordingCommand`: 녹화 시작
  - `StopRecordingCommand`: 녹화 중지
  - `TakeSnapshotCommand`: 스냅샷 촬영
  - `ApplyCameraSettingsCommand`: 카메라 설정 적용

### 📂 Views (사용자 인터페이스)
**위치**: `SrVsDataset/`

#### `MainWindow.xaml` + `MainWindow.xaml.cs`
- **역할**: 메인 사용자 인터페이스
- **구성 요소**:
  - 환경 설정 패널 (도로종류, 날씨, 시간대, 녹화위치)
  - 카메라 설정 패널 (노출시간, 화이트밸런스)
  - 녹화 제어 패널 (초기화, 스냅샷, 녹화 버튼)
  - 실시간 카메라 프리뷰
  - 상태바 (온도, 저장 경로)

## 📊 데이터 흐름

```
카메라 → MVCameraService → MainViewModel → MainWindow
                ↓
            프레임 데이터
                ↓
         VideoRecordingService → 파일 저장
                ↓
      FileManagementService → 메타데이터 저장
```

## 🔧 주요 기능

### 1. 카메라 제어
- MVSDK 기반 실제 카메라 연결
- 실시간 프리뷰 (30 FPS)
- 노출 시간 조절 (1-100,000 μs)
- 화이트밸런스 설정 (자동/수동)

### 2. 데이터 수집
- 환경 조건별 폴더 구조 자동 생성
- 비디오 파일 (.mp4) + 메타데이터 (.json) 쌍으로 저장
- GPS 좌표, 카메라 온도 등 하드웨어 정보 수집

### 3. 사용자 인터페이스
- 직관적인 원클릭 조작
- 실시간 상태 모니터링
- 스냅샷 기능으로 연결 확인

## 📁 파일 명명 규칙
```
YYYYMMDD_HHMMSS(시작)_HHMMSS(종료)_[위치].mp4
YYYYMMDD_HHMMSS(시작)_HHMMSS(종료)_[위치].json
```

## 🗂️ 폴더 구조
```
LANE_REPAINT_DATASET/
├── highway/
│   ├── clear/
│   │   ├── am/
│   │   │   ├── left/
│   │   │   └── right/
│   │   ├── midday/
│   │   ├── pm/
│   │   └── night/
│   └── cloudy/
└── urban/
    ├── clear/
    └── cloudy/
```

## 🔄 개선 사항 (최근 업데이트)
1. **버튼 상태 관리**: 카메라 초기화 중 버튼 비활성화
2. **실시간 프리뷰**: byte[] → BitmapSource 변환 구현
3. **스냅샷 기능**: 카메라 연결 확인용 이미지 저장
4. **주석 한글화**: 코드 가독성 향상